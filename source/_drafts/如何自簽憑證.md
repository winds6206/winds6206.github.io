---
title: 如何自簽憑證(Self-signed certificate)
tags:
  - openssl
  - CA
  - HTTPS
  - SSL憑證
  - certificate
  - SHA256
  - SHA-2
categories:
  - Linux
abbrlink: 643d73cc
---

## 前言

常常我們在自己本機或開發環境可能需要使用憑證，但是透過憑證認證機構（Certificate Authority，CA）來去做簽發會需要額外花費一筆費用，下面會使用 openssl 的指令來自簽憑證，自簽憑證因為非憑證認證機構所簽發，所以會被瀏覽器判定為不安全的，但還是有加密的效果

Google Chrome 於2017年1月1日起，終止支援所有SHA-1憑證，所以下面的範例會以SHA-2(SHA256) 來簽發

<!--more-->

## 自簽憑證的方式

安裝 openssl 套件，如果是用紅帽系列的作業系統，可以直接 yum 安裝，如果是使用 Mac OS X 或者其他作業系統，再自行依照個系統的方式來安裝

```
yum install openssl
```

產生私鑰(private key)，名稱為 ca.key，名稱可以自取 `[key_Name].key`

```
openssl genrsa -out ca.key 4096
```

利用剛剛的私鑰來產生csr，這邊指令產生出來的檔案名稱為 ca.csr，名稱可以自取 `[csr_Name].csr`，記得加上 `-sha256` 參數

> 如果是要拿到憑證認證機構(CA) 去簽發，就是拿 csr 去提交並驗證，完成後證認證機構就會給你 crt 檔案

```
openssl req -new -sha256 -key ca.key -out ca.csr
```

再來系統會請你填入憑證資訊，以下僅供參考，請依照自己的實際環境填寫

```
Country Name (2 letter code) []:TW → 一定要填兩個字母
State or Province Name (full name) []:Taichung
Locality Name (eg, city) []:Taichung
Organization Name (eg, company) []:abc
Organizational Unit Name (eg, section) []:RD
Common Name (eg, fully qualified host name) []:localhost → 依照自己的實際情況填寫，如果是跑 localhost 就填入 localhost
Email Address []:xx@gmail.com

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []: 直接 enter 略過
```

驗證是否為 SHA256 → Signature Algorithm: sha256WithRSAEncryption

```
openssl req -in ca.csr -text
```

因為這邊訴求是自簽憑證，所以我們必須自己擔任憑證認證機構，自己簽發自己的 crt，拿著剛剛產生的 key 和 csr 來簽發，下面簽發到期天數是3650天，可以自行調整，輸出的 crt 的檔名為 ca.crt，名稱可以自取 `[crt_Name].crt`，這邊也要記得加上 `-sha256` 參數

```
openssl x509 -req -days 3650 -in ca.csr -signkey ca.key -sha256 -out ca.crt
```

驗證是否為 SHA256 → Signature Algorithm: sha256WithRSAEncryption

```
openssl x509 -in ca.crt -text
```

以上就是自簽憑證的方式

## 參考資料

- https://blog.codebar.tw/self-signed-certificate-by-using-openssl-ec22a0257a28
- https://blog.gslin.org/archives/2014/11/20/5353/openssl-%E7%94%A2%E7%94%9F%E4%B8%A6%E7%B0%BD%E5%87%BA-sha2-sha256-%E7%9A%84%E6%86%91%E8%AD%89/
