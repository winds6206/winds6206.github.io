---
title: Nginx高併發優化
tags:
---

## 前言

公司網站是採 K8s 架構，近期因為線上人數較多，目前的總連線數跟以前相比確實高出許多，但還不至於太誇張，後端4個 Nginx Pod 在運行 QPS 最高峰約莫接近 500，平均分攤在四個 Pod 上，一個 Pod 僅不過約 125 QPS，為了求穩定，還是需要做預防性的優化 Nginx，以避免後續人數越來越多導致效能下降甚至系統崩潰。

所以今天會針對 Nginx 高併發如何優化的角度來切入

<!--more-->

## 連線原理

在高併發的場景下，最怕的就是 Nginx 產生太多的 TIME_WAIT 狀態，在 TIME_WAIT 狀態結束之前，該 socket 會一直佔用的本地埠號而無法釋放
，嚴重會導致系統所有可用埠號都被佔光，這時候就無法再建立任何連線，所以在高併發的場景，我們要盡可能的降低連線數，


## 文後討論

## 參考資料
