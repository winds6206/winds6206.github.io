---
title: 文章測試
date: 2021-04-19 16:38:43
tags: GCP
---

# 容器原生負載平衡(Container-native load balancing)

容器原生負載平衡(Container-native load balancing) 就是使用 NEGs 的方式來達成，意指不使用 iptables 的方式來達到負載平衡，

> Container-native load balancing leverages a data model called network endpoint groups (NEGs). NEGs are collections of network endpoints represented by IP-port pairs.[1]

<!--more-->

一般來說如果是 GKE 1.16(含) 以下要啟用 NEG 功能，需要在 Service Object 的 annotation 加上 `cloud.google.com/neg: '{"ingress": true}'`；而 GKE 1.17 以上(含) 預設已經啟用 NEG，無需額外添加 annotation

## 啟用 NEGs(Network Endpoint Groups) 的條件

- 需使用 alias IPs(如果建立叢集時沒有指定 secondary IP，使用GCP預設發配的，就代表沒有 alias IPs)
- GKE 1.16(含)以下 要啟用 NEG 功能，需要在 Service Object 的 annotation 加上 `cloud.google.com/neg: '{"ingress": true}'`
- GKE 1.17 (含)以上 預設已經啟用 NEG，無需額外添加 annotation

alias IPs是否啟用，可以使用以下指令去檢查 `useIpAliases` 的項目是否為 True

```
gcloud container clusters describe [叢集名稱] --project=[專案ID] --region=[叢集所在Region]
```

---test---
